var ratings_mouseover_image,$j=jQuery.noConflict(),is_being_rated=!1,postratings_captcha=null;function postratings_init_vars(){if(ratingsL10n.custom=parseInt(ratingsL10n.custom),ratingsL10n.max=parseInt(ratingsL10n.max),ratingsL10n.show_loading=parseInt(ratingsL10n.show_loading),ratingsL10n.show_fading=parseInt(ratingsL10n.show_fading),ratingsL10n.baseimg=ratingsL10n.plugin_url+"/images/"+ratingsL10n.image+"/rating",ratingsL10n.rtl=parseInt(ratingsL10n.rtl),ratingsL10n.custom){ratings_mouseover_image=[];for(var t=1;t<=ratingsL10n.max;t++)ratings_mouseover_image[t]=new Image,ratings_mouseover_image[t].src=ratingsL10n.baseimg+"_"+t+"_over."+ratingsL10n.image_ext}else(ratings_mouseover_image=new Image).src=ratingsL10n.baseimg+"_over."+ratingsL10n.image_ext}function postratings_setup_evt_listeners(){jQuery("img[data-votes]").on("mouseover mouseout",current_rating).on("click keypress",rate_post)}function getRtlI(t){return ratingsL10n.rtl?ratingsL10n.max-t+1:t}function getOver(t){return ratingsL10n.custom?ratings_mouseover_image[getRtlI(t)].src:ratings_mouseover_image.src}function getOn(t){return ratingsL10n.baseimg+(ratingsL10n.custom?"_"+getRtlI(t):"")+"_"+getRtlDir("on")+"."+ratingsL10n.image_ext}function getOff(t){return ratingsL10n.baseimg+(ratingsL10n.custom?"_"+getRtlI(t):"")+"_"+getRtlDir("off")+"."+ratingsL10n.image_ext}function getHalf(t){return ratingsL10n.baseimg+(ratingsL10n.custom?"_"+getRtlI(t):"")+"_"+getRtlDir("half")+"."+ratingsL10n.image_ext}function getRtlDir(t){if(!ratingsL10n.rtl)return t;switch(t){case"on":return"off";case"off":return"on";case"half":return"half-rtl";default:return""}}function is_using_ajax(t){return Boolean($j("#post-ratings-"+t).data("ajax"))}function non_ajax_hidden_parent(t){var n=$j('input[name="wp_postrating_form_value_'+t+'"]');return 1==n.length&&n}function current_rating(t){var n=$j(t.target),a=$j(t.target).data("id"),e=$j(t.target).data("currentRating"),r=$j(t.target).data("votes"),i=$j(t.target).data("half");if(!is_being_rated){var s=NaN;if(!is_using_ajax(a)){var g=non_ajax_hidden_parent(a);s=parseInt(g.val())}var o,_=[],u=ratingsL10n.max;for(o=1;o<=u;o++)f(o);for(o=1;o<=e;o++)c(o);if(i>r&&function(t){_[t]=getHalf(t)}(i),!isNaN(s))if("mouseover"==t.type)for(o=1;o<=Math.min(s,r);o++)p(o);else for(o=1;o<=s;o++)p(o);if("mouseover"==t.type)for(o=1;o<=r;o++)p(o);for(o=1;o<=u;o++)document.querySelector("img#rating_"+a+"_"+o).setAttribute("src",_[o]);updateText($j("#ratings_"+a+"_text"),n,"mouseout"==t.type)}function c(t){_[t]=getOn(t)}function f(t){_[t]=getOff(t)}function p(t){_[t]=getOver(t)}}function updateText(t,n,a){t.length&&(a?t.hide().empty():t.html(n.data("ratingsText")).show())}function rate_post_success(t,n){$j("#post-ratings-"+t).html(n),ratingsL10n.show_loading&&$j("#post-ratings-"+t+"-loading").hide(),ratingsL10n.show_fading&&$j("#post-ratings-"+t).fadeTo("def",1)}function rate_post(t){var n=$j(t.target),a=$j(t.target).data("id"),e=$j(t.target).data("votes"),r="";if(!is_using_ajax(a)){var i=non_ajax_hidden_parent(a),s=$j(i).val();return $j(i).val(null),$j("#rating_"+a+"_"+s).trigger("mouseout"),void(s!=e&&($j("#rating_"+a+"_"+e).trigger("mouseover"),$j(i).val(e)))}if(ratingsL10n.captcha_sitekey&&ratingsL10n.captcha_sitekey.length){if(null===postratings_captcha)return void(postratings_captcha=grecaptcha.render("g-recaptcha-response",{sitekey:ratingsL10n.captcha_sitekey}));if(r=grecaptcha.getResponse(postratings_captcha),!grecaptcha.getResponse(postratings_captcha))return;$j("#g-recaptcha-response").remove()}if(is_being_rated)alert(ratingsL10n.text_wait);else{var g=$j(n).parent(".post-ratings").data("nonce");is_being_rated=!0,ratingsL10n.show_fading?$j(n).fadeTo("def",0,function(){ratingsL10n.show_loading&&$j("#post-ratings-"+a+"-loading").show()}):ratingsL10n.show_loading&&$j("#post-ratings-"+a+"-loading").show(),$j.post({xhrFields:{withCredentials:!0},dataType:"html",url:ratingsL10n.ajax_url,data:"action=postratings&pid="+a+"&rate="+e+"&postratings_"+a+"_nonce="+g+"&g-recaptcha-response="+r,cache:!1}).done(function(t){rate_post_success(a,t)}).always(function(){is_being_rated=!1})}}jQuery(function(){postratings_init_vars(),postratings_setup_evt_listeners()});
